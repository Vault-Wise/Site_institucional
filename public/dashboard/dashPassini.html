<!DOCTYPE html>
<html lang="pt-br">

<head>
  <link rel="shortcut icon" href="../assets/icon/index.ico" type="image/x-icon" />
  <meta charset="UTF-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Dashboard | VaultWise</title>

  <link rel="stylesheet" href="../css/dashboard.css" />
  <link rel="stylesheet" href="../css/dashboardPassini.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css" />

  <script src="../js/sessao.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/apexcharts"></script>
</head>

<body>
  <div class="pagina">
    <nav>
      <ul id="listaNavegacao">
        <li>
          <a href="#">
            <div class="cargoUsuario">
              <div class="usuario">
                <img src="../css/imagens/icon12.jpg" alt="">
                <span id="b_usuario">Usuário</span>
              </div>
              <div class="cargo">
                <span id="cargo_usuario"></span>
              </div>
            </div>
          </a>
        </li>
      </ul>
    </nav>
    <div class="container">
      <div class="caixaGraficos">
        <div class="caixaGraficos">
          <h2>Componentes</h2>
        </div>
        <div class="graficos">
          <div id="chartRedeEnvio" class="graficoUm">Grafico Rede <br> Recebimento</div>
          <div id="chartRedeRecebimento" class="graficoDois"> Grafico Rede <br> Envio</div>
        </div>



      </div>


      <div class="parteBaixo">
        <div class="tabela">
          <table id="tabelaPID">
            <thead>
                <tr>
                    <th>Posição</th>
                    <th>PID</th>
                    <th>Nivel de Ameaça</th>
                   
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td><b>1º</b></td>
                    <td></td>
                    <td>%</td>
                    <td>%</td>
                </tr>
                <tr>
                    <td><b>2º</b></td>
                    <td></td>
                    <td></td>
                    <td></td>
                </tr>
                <tr>
                    <td><b>3º</b></td>
                    <td></td>
                    <td></td>
                    <td></td>
                </tr>
            </tbody>
        </table>
        </div>
        <section class="conteudo">
          <div class="card">
        <div class="finalizarProcesso">
          <div class="titulo">
            <h1>Finalizar Processo</h1>
          </div>
          <div class="campos">
          <input type="number" id="pidInput" placeholder="Digite o PID">
          <button id="finalizarBtn">Finalizar Processo</button>
          <p id="status"></p>
        </div>
        </div>
      </div>
      </section>
      </div>
    </div>

</body>



</html>

<script>

  document.addEventListener("DOMContentLoaded", () => {
    validarSessao()

    const dashPassini = document.getElementById("dashPassini");
    const dashVini = document.getElementById("dashVini");

    if (!dashPassini.classList.contains("agora")) {
      dashPassini.classList.add("agora");
    }

    if (dashVini.classList.contains("agora")) {
      dashVini.classList.remove("agora")
    }
  });

  document.getElementById('finalizarBtn').addEventListener('click', () => {

    const pid = document.getElementById('pidInput').value;

    if (!pid || isNaN(pid)) {
      document.getElementById('status').innerText = 'Por favor, insira um PID válido.';
      return;
    }

    // Enviar uma requisição para o backend (API Node.js)
    fetch(`http://localhost:3333/dashPassini/rota/${pid}`)
      // http://localhost:3333/matar-processo/${pid}
      .then(response => response.text())
      .then(data => {
        console.log(data)
        document.getElementById('status').innerText = `Resultado: ${data}`;
      })
      .catch(error => {
        document.getElementById('status').innerText = `Erro: ${error.message}`;
      });
  });

  function carregarDados() {
            const fkCaixa = 1;  // Substitua isso pelo valor de fkCaixa que você deseja consultar

            fetch(`http://localhost:3333/dashPassini2/capturaPIDs/${fkCaixa}`)  // Chama a API com o fkCaixa
                .then(response => response.json())  // Converte a resposta para JSON
                .then(data => {
                    // Aqui você insere os dados na tabela
                    const tabelaBody = document.querySelector('#tabelaPID tbody');
                    tabelaBody.innerHTML = '';  // Limpa a tabela antes de adicionar os dados

                    // Loop através dos dados e cria as linhas da tabela
                    data.forEach(item => {
                        const tr = document.createElement('tr');
                        tr.innerHTML = `
                            <td>${item.idPID}</td>
                            <td>${item.numeroPID}</td>
                            <td>${item.nivelAmeaca}</td>
                        `;
                        tabelaBody.appendChild(tr);  // Adiciona a linha na tabela
                    });
                })
                .catch(error => {
                    console.error('Erro ao carregar os dados:', error);
                });
        }

        // Chama a função para carregar os dados quando a página for carregada
        window.onload = carregarDados;

  var options = {
    series: [{
      name: "Desktops",
      data: [10, 41, 35, 51, 49, 62, 69, 91, 148]
    }],
    chart: {
      height: 250,
      type: 'line',
      zoom: {
        enabled: false
      }
    },
    dataLabels: {
      enabled: false
    },
    stroke: {
      curve: 'straight'
    },
    title: {
      align: 'left'
    },
    grid: {
      row: {
        colors: ['#f3f3f3', 'transparent'], // takes an array which will be repeated on columns
        opacity: 0.5
      },
    },
    xaxis: {
      categories: ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep'],
    }
  };

  var chart = new ApexCharts(document.querySelector("#chartRedeEnvio"), options);
  chart.render();

  var options = {
    series: [{
      name: "Desktops",
      data: [10, 41, 35, 51, 49, 62, 69, 91, 148]
    }],
    chart: {
      height: 250,
      type: 'line',
      zoom: {
        enabled: false
      }
    },
    dataLabels: {
      enabled: false
    },
    stroke: {
      curve: 'straight'
    },
    title: {
      align: 'left'
    },
    grid: {
      row: {
        colors: ['#f3f3f3', 'transparent'], // takes an array which will be repeated on columns
        opacity: 0.5
      },
    },
    xaxis: {
      categories: ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep'],
    }
  };

  var chart = new ApexCharts(document.querySelector("#chartRedeRecebimento"), options);
  chart.render();

</script>