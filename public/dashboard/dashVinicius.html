<!DOCTYPE html>
<html lang="pt-br">
  <head>
    <link
      rel="shortcut icon"
      href="../assets/icon/index.ico"
      type="image/x-icon"
    />
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Dashboard | VaultWise</title>

    <link rel="stylesheet" href="./../css/dashboards.css" />
    <link rel="stylesheet" href="./../css/dashboardVinicius.css" />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css"
    />

    <script src="../js/sessao.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/apexcharts"></script>
  </head>

  <body onload="capturarDados()">
    <div class="container">
      <nav>
        <ul id="listaNavegacao">
          <li>
            <a href="#">
              <div class="cargoUsuario">
                <div class="usuario">
                  <img src="../css/imagens/icon12.jpg" alt="" />
                  <span id="b_usuario">Usuário</span>
                </div>
                <div class="cargo">
                  <span id="cargo_usuario" style="font-size: 15px; margin-top: 10px"></span>
                </div>
              </div>
            </a>
          </li>
        </ul>
      </nav>
      <section class="main">
        <div class="main-cima">
          <h1>Monitoramento de REDE</h1>
        </div>
        <div class="investimentos">
          <div class="card">
            <i class="fa-solid fa-laptop d"></i>
            <h3>Máquina a ser monitorada</h3>
            <div class="filters">
              <select class="agencia-select">
                <option disabled selected>Agências</option>
                <option>Itau</option>
                <option>C6</option>
                <option>Bradesco</option>
              </select>
              <select class="situacao-select">
                <option disabled selected>Situações</option>
                <option>Alerta</option>
                <option>Perigo</option>
                <option>Seguro</option>
              </select>
            </div>
          </div>
        </div>
        <section class="analise">
          <div class="caixa">
            <ul>
              <li class="texto_caixa">Componentes</li>
            </ul>
            <div class="course">
              <div class="caixa1">
                <h3>ACHAR MÊTRICA PARA CPU</h3>
                <p>Rede</p>
                <div id="chartMemoria"></div>
              </div>
              <div class="caixa1">
                <h3>Uso de CPU</h3>
                <p>Porcentagem de Uso</p>
                <div id="chartProcessador"></div>
              </div>
            </div>
          </div>

          <div class="caixa">
            <div class="filters">
              <select class="agencia-select">
                <option disabled selected>Agências</option>
                <option>Itau</option>
                <option>C6</option>
                <option>Bradesco</option>
              </select>
              <select class="situacao-select">
                <option disabled selected>Situações</option>
                <option>Alerta</option>
                <option>Perigo</option>
                <option>Seguro</option>
              </select>
            </div>
            <table>
              <thead>
                <tr>
                  <th>Agência</th>
                  <th>Máquina</th>
                  <th>Indicador</th>
                </tr>
              </thead>
              <tbody>
                <tr>
                  <td>Agência A</td>
                  <td>Máquina 1</td>
                  <td>Ativo</td>
                </tr>
                <tr>
                  <td>Agência B</td>
                  <td>Máquina 2</td>
                  <td>Inativo</td>
                </tr>
                <tr>
                  <td>Agência B</td>
                  <td>Máquina 2</td>
                  <td>Inativo</td>
                </tr>
                <tr>
                  <td>Agência B</td>
                  <td>Máquina 2</td>
                  <td>Inativo</td>
                </tr>
                <tr>
                  <td>Agência B</td>
                  <td>Máquina 2</td>
                  <td>Inativo</td>
                </tr>
                <tr>
                  <td>Agência B</td>
                  <td>Máquina 2</td>
                  <td>Inativo</td>
                </tr>

                <!-- Outros registros -->
              </tbody>
            </table>
          </div>
        </section>
      </section>
    </div>

    <script>
      validarSessao();

      document.addEventListener("DOMContentLoaded", () => {
        const dashVini = document.getElementById("dashVini");
        if (!dashVini.classList.contains("agora")) {
          dashVini.classList.add("agora");
        }
        b_usuario.innerHTML = sessionStorage.NOME_USUARIO;
      });

      function capturarDados() {
    // Inicializa gráficos com animação
    const chartMemoria = new ApexCharts(document.querySelector("#chartMemoria"), {
        chart: { 
            type: "line", 
            animations: {
                enabled: true, 
                easing: 'easeinout', 
                speed: 800,
                animateGradually: {
                    enabled: true,
                    delay: 150
                },
                dynamicAnimation: {
                    enabled: true,
                    speed: 500
                }
            }
        },
        series: [{ name: "Memória (%)", data: [] }],
        xaxis: { categories: [] }
    });
    chartMemoria.render();

    const chartProcessador = new ApexCharts(document.querySelector("#chartProcessador"), {
        chart: { 
            type: "line", 
            animations: {
                enabled: true,
                easing: 'easeinout',
                speed: 800,
                animateGradually: {
                    enabled: true,
                    delay: 150
                },
                dynamicAnimation: {
                    enabled: true,
                    speed: 500
                }
            }
        },
        series: [{ name: "Processador (%)", data: [] }],
        xaxis: { categories: [] }
    });
    chartProcessador.render();

    // Função de atualização dos gráficos
    function atualizarGraficos() {
        fetch("/graficoDash/mostrarDados", { method: "GET" })
            .then((response) => response.json())
            .then((data) => {
                const times = data.map(item => new Date(item.dtHora).toLocaleTimeString());
                const percentMemoriaData = data.map(item => item.percentMemoria);
                const percentProcessadorData = data.map(item => item.percentProcessador);

                // Atualiza os gráficos com animação
                chartMemoria.updateSeries([{ data: percentMemoriaData }], true);
                chartMemoria.updateOptions({ xaxis: { categories: times } });

                chartProcessador.updateSeries([{ data: percentProcessadorData }], true);
                chartProcessador.updateOptions({ xaxis: { categories: times } });
            })
            .catch((error) => console.log("Erro ao acessar dados: ", error));
    }

    // Atualiza os gráficos a cada 5 segundos
    atualizarGraficos();
    setInterval(atualizarGraficos, 5000);
}

    </script>
  </body>
</html>
