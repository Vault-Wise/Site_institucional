<!DOCTYPE html>
<html lang="pt-BR">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Vault Wise - Crie sua conta</title>
  <link rel="stylesheet" href="css/styleCadastroEmpresa.css">
  <link rel="shortcut icon" type="imagex/png" href="css/imagens/logoComFundo.png">
  <script src="js/sessao.js"></script>
</head>

<body>
  <header>
    <div class="logo"><img src="css/imagens/logoSemFundo.png" alt=""></div>
    <div class="logo">VaultWise</div>
    <nav>
      <ul id="link_nav">
        <li><a href="index.html">Home</a></li>
        <li><a href="index.html#sobre_nos">Sobre</a></li>
        <li class="btn_login"><a href="Login.html">Login</a></li>
      </ul>
    </nav>
    <button class="hamburguer" onclick="ativarMenu()">&#9776;</button>
  </header>
  <div class="container">
    <div class="form-container">
      <h1>Olá XXXXX!</h1>
      <h2>Cadastro de Empresas<span style="color: #012e5c;">.</span></h2>
      <p>já possui conta?<a href="#"><span style="color: #81aad2;"> Login</span></a></p>
      <div class="inputs1">
        <input type="text" placeholder="Razão Social" class="input_razaosocial" id="input_razaosocial">
        <input type="text" placeholder="CNPJ" maxlength="18" onkeypress="mascararCnpj(Event)" class="input_cnpj"
          id="input_cnpj">
      </div>
      <div class="inputs2">
        <input type="text" placeholder="CEP" maxlength="9" onkeypress="mascararCep(Event)" class="input_cep"
          id="input_cep">
        <input type="text" placeholder="Telefone" maxlength="15" onkeypress="mascararTel(Event)" class="input_telefone"
          id="input_telefone">
      </div>
      <div class="inputs3">
        <input type="text" placeholder="Numero" class="input_email" id="input_numero">
      </div>
      <div class="buttons">
        <button onclick="cadastrar()" class="btn-primary">Criar Conta</button>
        <button onclick="mudarCadastro()" type="button" class="btn-secondary">Mudar Cadastro</button>

      </div>
    </div>
  </div>
</body>

</html>

<script>
  // Array para armazenar empresas cadastradas para validação de código de ativação 
  // let listaEmpresasCadastradas = [];

  function ativarMenu() {
    var linknav = document.getElementById("link_nav")
    linknav.classList.toggle("ativo")
  }

  function mudarCadastro() {
    window.location.href = "CadastroFuncionario.html"
  }

  function cadastrar() {
    var razaoSocial = input_razaosocial.value;
    var cnpj = removerMascara(input_cnpj.value);
    var cep = removerMascara(input_cep.value);
    var telefone = removerMascara(input_telefone.value);
    var numero = input_numero.value;

    if (razaoSocial === "" || cnpj === "" || cep === "" || telefone === "" || numero == "") {
      alert("Digite válidos")
    }
    fetch("/empresas/cadastrar", {
      method: "POST",
      headers: {
        "Content-Type": "application/json",
      },
      body: JSON.stringify({
        razaoSocialServer: razaoSocial,
        cnpjServer: cnpj,
        cepServer: cep,
        telefoneServer: telefone,
        numeroServer: numero
      }),
    })
      .then(function (resposta) {
        console.log("resposta: ", resposta);

        if (resposta.ok) {
          setTimeout(() => {
            window.location = "CadastroFuncionario.html";
          }, 2000);
        } else {
          throw new Error("Houve um erro ao tentar realizar o cadastro!");
        }
      })
      .catch(function (erro) {
        console.log(`#ERRO: ${erro}`);
      });
  }


  function removerMascara(valorComMascara) {
    var valorSemMascara = valorComMascara.replaceAll("-", "");

    valorSemMascara = valorSemMascara.replaceAll(".", "");

    valorSemMascara = valorSemMascara.replaceAll(" ", "");

    valorSemMascara = valorSemMascara.replaceAll("(", "");
    valorSemMascara = valorSemMascara.replaceAll(")", "");

    valorSemMascara = valorSemMascara.replaceAll("/", "");

    return valorSemMascara
  }

  function mascararTel(Event) {
    var telefonelength = input_telefone.value.length;
    var ultimoChar = input_telefone.value.charAt(telefonelength - 1);    // Verifica se o último caractere adicionado foi ponto ou traço
    if (Event.key == "Backspace") {


    } else {
      if ((ultimoChar !== '(' && ultimoChar !== ')' && ultimoChar !== '-' && ultimoChar !== ' ') && telefonelength !== 15) {
        if (telefonelength === 0) {
          input_telefone.value += '(';
        } else if (telefonelength === 3) {
          input_telefone.value += ') ';
        } else if (telefonelength === 10) {
          input_telefone.value += '-';
        }
      }
    }
  }

  function mascararCnpj(Event) {
    var tamCpnj = input_cnpj.value.length;
    var ultimoChar = input_cnpj.value.charAt(tamCpnj - 1);    // Verifica se o último caractere adicionado foi ponto ou traço
    if (Event.key == "Backspace") {

    } else {
      console.log((ultimoChar !== '.' && ultimoChar !== '/' && ultimoChar !== '-') && tamCpnj !== 18)
      if ((ultimoChar !== '.' && ultimoChar !== '/' && ultimoChar !== '-') && tamCpnj !== 18) {
        if (tamCpnj === 2 || tamCpnj === 6) {
          input_cnpj.value += '.';
        } else if (tamCpnj === 10) {
          input_cnpj.value += '/';
        } else if (tamCpnj === 15) {
          input_cnpj.value += '-';
        }
      }
    }
  }

  function mascararCep(Event) {
    var tamCep = input_cep.value.length;
    var ultimoChar = input_cep.value.charAt(tamCep - 1);    // Verifica se o último caractere adicionado foi ponto ou traço
    if (Event.key == "Backspace") {

    } else {
      if ((ultimoChar !== '-') && tamCep !== 9) {
        if (tamCep === 5) {
          input_cep.value += '-';
        }
      }
    }
  }

  //  function sumirMensagem() {
  //    cardErro.style.display = "none";
  //  }
</script>