<!DOCTYPE html>
<html lang="pt-BR">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Vault Wise - Cadastro de Equipamentos</title>
    <link rel="stylesheet" href="css/styleCadastroEquipamento.css">
    <link rel="shortcut icon" type="imagex/png" href="css/imagens/logosemfundo.png">

</head>

<body onload="listar()">
    <header>
        <div class="logo"><img src="css/imagens/logosemfundo.png" alt=""></div>
        <div class="logo">VaultWise</div>
        <nav>
            <ul id="link_nav">
                <li><a href="index.html">Home</a></li>
                <li><a href="index.html#sobre_nos">Sobre</a></li>
                <li class="btn_login"><a href="Login.html">Login</a></li>
            </ul>
        </nav>
        <button class="hamburguer" onclick="ativarMenu()">&#9776;</button>
    </header>
    <div class="container">
        <div class="form-container">
            <h2>Cadastro de Equipamentos<span style="color: #982727;">.</span></h2>
            <form>
                <input type="text" placeholder="ID do equipamento" id="input_equip" class="input_equip">
                <select name="empresas" id="listaEmpresas">
                    <option selected>Selecione uma empresa</option>
                </select>
                <div class="buttons">
                    <button onclick="cadastrar()" type="submit" class="btn-primary">Cadastrar</button>
                </div>
            </form>
            
        </div>
        <div id="div_mensagemErro" style="color: red;"></div>
    </div>
</body>

</html>

<script>
    function cadastrar() {
        event.preventDefault();
        var equipID = input_equip.value;
        var empresaVar = listaEmpresas.value;

        if (equipID == "" || empresaVar == "Selecione uma empresa") {
            div_mensagemErro.innerHTML = '<u>Atenção!</u> Todos os campos precisam ser preenchidos para o cadastro!';
        } else if (equipID.length <= 1) {
            div_mensagemErro.innerHTML = 'O ID do equipamento deve ter mais de 1 caractere.';
        } else {
            fetch("/equipamentos/cadastrar", {
                method: "POST",
                headers: {
                    "Content-Type": "application/json",
                },
                body: JSON.stringify({
                    idEquipamentoServer: equipID,
                    empresaServer: empresaVar
                }),
            })
            .then(function (resposta) {
                if (resposta.ok) {
                    div_mensagemErro.innerHTML = "Cadastro realizado com sucesso!";
                    setTimeout(() => {
                        window.location = "login.html";
                    }, 2000);
                } else {
                    div_mensagemErro.innerHTML = "Houve um erro ao tentar realizar o cadastro!";
                }
            })
            .catch(function (resposta) {
                console.log(`#ERRO: ${resposta}`);
            });
        }
    }

    function listar() {
        fetch("/empresas/listar", {
            method: "GET",
        })
            .then(function (resposta) {
                resposta.json().then((empresas) => {
                    empresas.forEach((empresa) => {
                        listaEmpresas.innerHTML += `<option value='${empresa.id}'>${empresa.cnpj}</option>`;
                    });
                });
            })
            .catch(function (resposta) {
                console.log(`#ERRO: ${resposta}`);
            });
    }
</script>